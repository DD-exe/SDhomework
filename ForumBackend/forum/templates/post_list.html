
<!-- templates/post_list.html -->
{% extends 'base.html' %}

{% load tz %}

{% block content %}
    <form method="GET" class="mb-4 text-center">
        <div class="container">
            <div class="row justify-content-center mb-3">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text">按主题</span>
                        <select class="form-select" name="subject">
                            <option value="">选择主题（默认不筛选）</option>
                            {% for subject in subjects %}
                                <option value="{{ subject.name }}" {% if subject.name == selected_subject %}selected{% endif %}>
                                    {{ subject.name }}
                                </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-success">搜索</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <h1 class="fw-bold text-center">帖子列表</h1>
    <ul>
        {% for post in page_obj %}
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8">  <!-- 设置列宽 -->
                        <div class="p-5 my-5 border">
                            <li>
                                <h2 class="text-center mb-3"><code class="fw-bold">{{ post.title }}</code></h2>
                            </li>
                            <div class="input-group mb-3">
                                <span class="input-group-text"> &ensp;主&ensp;&ensp;题&ensp; </span>
                                <input readonly class="form-control text-center" value="{{ post.subject }}">
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text"> &ensp;内&ensp;&ensp;容&ensp; </span>
                                <textarea readonly class="form-control text-center" style="height: 38px;">{{ post.content }}</textarea>
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text"> &ensp;用&ensp;&ensp;户&ensp; </span>
                                <input readonly class="form-control text-center" value="{{ post.user.username }}">
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text"> 发帖时间 </span>
                                <input readonly class="form-control text-center" value="{{ post.created_at }}">
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text"> 最后更新 </span>
                                <input readonly class="form-control text-center" value="{{ post.updated_at }}">
                            </div>
                            <div style="text-align:center;">
                                <form action="{% url 'edit_post' post.id %}" method="POST" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-outline-warning btn-lg">编辑</button>
                                </form>
                                <form action="{% url 'delete_post' post.id %}" method="POST" style="display:inline;" onsubmit="return confirmDelete();">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-outline-danger btn-lg">删除</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8">  <!-- 设置列宽 -->
                        <div class="p-5 my-5 border">
                            <li>
                                <h2 class="text-center"><code>没有帖子可显示</code></h2>
                            </li>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </ul>

<div class="card">
  <div class="card-footer bg-light text-white">
      <nav aria-label="Page navigation" class="text-center">
          <ul class="pagination justify-content-center">
              <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
                  <a class="btn btn-outline-primary" href="{% if page_obj.has_previous %}?page=1{% else %}javascript:void(0);{% endif %}" aria-label="First" {% if not page_obj.has_previous %}onclick="return false;"{% endif %}>
                      <span aria-hidden="true">{% if not page_obj.has_previous %}已经是第一页{% else %}&laquo; 第一页{% endif %}</span>
                  </a>
              </li>
              <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
                  <a class="btn btn-outline-info" href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% else %}javascript:void(0);{% endif %}" aria-label="Previous" {% if not page_obj.has_previous %}onclick="return false;"{% endif %}>
                      <span aria-hidden="true">上一页</span>
                  </a>
              </li>

              <li class="page-item disabled">
                  <span class="page-link">第 {{ page_obj.number }} 页，共 {{ page_obj.paginator.num_pages }} 页</span>
              </li>

              <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
                  <a class="btn btn-outline-info" href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% else %}javascript:void(0);{% endif %}" aria-label="Next" {% if not page_obj.has_next %}onclick="return false;"{% endif %}>
                      <span aria-hidden="true">下一页</span>
                  </a>
              </li>
              <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
                  <a class="btn btn-outline-primary" href="{% if page_obj.has_next %}?page={{ page_obj.paginator.num_pages }}{% else %}javascript:void(0);{% endif %}" aria-label="Last" {% if not page_obj.has_next %}onclick="return false;"{% endif %}>
                      <span aria-hidden="true">{% if not page_obj.has_next %}已经是最后一页{% else %}最后一页 &raquo;{% endif %}</span>
                  </a>
              </li>
          </ul>
      </nav>
      <h1 class="text-center"><code>THAT'S THE END</code></h1>
  </div>
</div>

<script>
    function confirmDelete(postId) {
        return confirm("确认删除这个帖子吗？");
    }
</script>

</ul>
{% endblock %}


